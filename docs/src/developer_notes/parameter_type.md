ratio[(unit=u, node1=ng1, node2=ng2, stochastic_scenario=s, analysis_time=t0, t=t)] (from constraint_ratio_unit_flow.jl) uses square brackets which would suggest that ratio is a vector. When you call ratio(unit=u,node1=ng1, node2=ng2), you get a number, as it should be. Furthermore there is ratio.name, which would suggests that ratio is of structure type.

The truth is that ratio is of Parameter type. You can find the definition in SpineInterface.jl/src/types.jl. Also, if you look at SpineInterface.jl/src/base.jl you will see that we implement Base.getindex for the Parameter type. The julia parser 'converts' x[y] to Base.getindex(x, y) as you may know. So when we write ratio[something] in our constraint code, we are actually calling Base.getindex(ratio, something). Now if you look at the definition of Base.getindex for Parameter in SpineInterface.jl/src/base.jl, you will see that we return a special object of type Call. The Call object is able to remember the parameter and the namedtuple it was called with. This is what allows SpineOpt models to update themselves automatically as the model rolls. By building constraints and objective with Call objects instead of just numbers, we are able to reevalute the Calls after the model rolls and retrieve the new values. This is all pretty sophisticated and has grown more and more sophisticated over the years in the original Spine project and before Mopo. I am available for a call if you want to learn all these details more in depth...