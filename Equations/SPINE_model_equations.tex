%%% !TEX program = lualatex
\documentclass[10pt,english]{article}
\usepackage[a4paper,bindingoffset=0in,left=1.3in,right=1.3in,top=1.2in,bottom=1in,footskip=.25in]{geometry}
\usepackage{lineno,hyperref}
\usepackage[margin=1cm]{caption}
% Packages I added:
%\usepackage{caption,subcaption}
% \usepackage{tablefootnote}
\usepackage{placeins} % For floatbarrier
% \usepackage[utf8]{inputenc}
\usepackage{color}
\usepackage{colortbl}
% \usepackage{arydshln} % For dashed line in table (appendix)
% \usepackage{multirow}
\usepackage{tabularx}
% \newcolumntype{R}{>{\raggedleft\arraybackslash}X}%
% \newcolumntype{C}{>{\centering\arraybackslash}X}%
% \newcolumntype{s}{>{\centering\arraybackslash\hsize=0.8\hsize}X}
% \newcolumntype{z}{>{\centering\arraybackslash\hsize=1.3\hsize}X}
% \newcolumntype{a}{>{\centering\arraybackslash\hsize=0.6\hsize}X}
% \newcolumntype{b}{>{\centering\arraybackslash\hsize=1.1\hsize}X}
% \newcolumntype{y}{>{\centering\arraybackslash\hsize=1.6\hsize}X}
% \newcolumntype{o}{>{\raggedright\arraybackslash\hsize=1.6\hsize}X}
% \newcolumntype{d}{>{\centering\arraybackslash\hsize=0.85\hsize}X}
% \newcolumntype{e}{>{\raggedright\arraybackslash\hsize=0.4\hsize}X}
% \newcolumntype{t}{>{\raggedright\arraybackslash\hsize=1.6\hsize}X}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[caption=false,font=normalsize]{subfig}
%\captionsetup[subfigure]{margin=20pt}
\usepackage{notoccite}
\usepackage{longtable}
% \usepackage{ltxtable}

\usepackage{eurosym}
\usepackage{tikz, pgfplots, graphicx}
\usetikzlibrary{spy,calc}
\usetikzlibrary{positioning}
\pgfplotsset{compat=newest}
\usepackage[space]{grffile} % For defining path variables with spaces
\usepgfplotslibrary{external} 
% \tikzexternalize[prefix=tikz/] % automatically saves pdfs generated by tikz into a folder tikz



\input{00_math_symbols}


% \bibliographystyle{elsarticle-num}



% \usepackage[colorlinks]{hyperref}
% \usepackage{breakurl}

% correct bad hyphenation here
% \hyphenation{op-tical net-works semi-conduc-tor ESOMs}


% \allowdisplaybreaks

% \bibliographystyle{elsarticle-num}
%%%%%%%%%%%%%%%%%%%%%%%

%\definecolor{LightCyan}{rgb}{0.88,1,1}
\interfootnotelinepenalty=10000

\newcommand{\myparagraph}[1]{\paragraph{#1}\mbox{}\\} % For having a new line after the paragraph title


\hyphenation{Euro-pean ap-pro-xi-ma-ted inte-gra-ting}
\title{Spine Model equations}
\date{}
\author{Kris Poncelet\textsuperscript{*,\#}\\ 
{\small \textsuperscript{\#}dr. ir. Kris Poncelet, Leuven, Belgium, kris.poncelet@mech.kuleuven.be} \\
{\small \textsuperscript{*}University of Leuven (KU Leuven) Energy Institute TME Branch, EnergyVille}}

\begin{document}

\voffset = 0pt

\maketitle{}


\textbf{Included in this document version:}
\begin{itemize}
\item Basic definition of variables, parameters and equations in order to:
\begin{itemize}
\item Establish a set of commodity flow(s) which define the capacity of the unit/technology 
\item A constraint restriciting the commodity flow(s) to the installed capacity of the unit/technology
\item Establisch a linear relationship between different commodity flows entering and leaving a specific unit/technology (in part)
\item Detailed technical constraints (UC type of constraints)
\item A commodity balance constraint
\end{itemize} 
\end{itemize} 


\textbf{Not included:}
\begin{itemize}
\item Geographical regions (treatment of nodes) and network related constraints (Maren, Jody)
\item Storage technologies
\item Temporal model structure (Juha? + Kris)
\item Objective function + flexibility
\item Bounds on absolute or total commodity flows
\item Stochastics (Juha?)
\end{itemize} 

\textbf{Open issues}: 
\begin{itemize}
\item What needs to be adapted if different commodity flows are tracked at a different level of temporal granularity?
\item Linking of different equations 'selected" by the archetype (Kris)
\item Feasible to treat reserve capacity as a commodity? -> Different types of reserves and constraints for reserve capacity dependent on type (e.g., spinning, non-spinning, upward, downward, ...) (Kris)
\item Dealing with the ability to have operational and investment planning problems. Many equations contain capacity-related terms. However, depending on the problem, these can be variables or parameters. Need duplicates of equations for both or does Julia/Jump has features to deal with this? (Kris)
\end{itemize}

\textbf{Next steps}:
\begin{itemize}
\item Compare to Backbone implementation + discuss!
\item Experiment with different archetypes for the coal-fired power plant example
\item Introduce the CHP example
\end{itemize}



\clearpage
\tableofcontents


\clearpage
\include{00_nomenclature}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Model formulation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Objective function}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The basic objective function of the Spine Model is to minimize the total discounted costs. 


The total costs will in the end comprise the following elements:
\begin{itemize}
	\item Costs:
	\begin{itemize}
		\item investment costs
		\item dismantling costs
		\item fixed O\&M costs
		\item variable O\&M costs
		\item import costs (exogenous commodity flows with a cost attached)
		\item production costs (related to domestic resource production, e.g., extracting oil from oil fields)
		\item taxes and subsidies associated with commodity flows
		\item taxes and subsidies associated with investments
		\item Utility loss following reduced end-use demands
		\item utility losses related to reduced reliability
	\end{itemize}
	\item Revenues:
	\begin{itemize}
		\item Salvage value (value of investments beyond the considered model horizon)
		\item export revenues
	\end{itemize}
\end{itemize}




\begin{align}
\vImportCosts = \sum_{\segments} \vImport \pImportCost \quad \forall \commodities, \timesteps
\end{align}

{\color{red} TO EXPAND}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Technological constraints}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Define unit/technology capacity}
%%%%%%%%%%%%%%%%%%%%%%%%%%%

In a multi-commodity setting, there can be different commodities entering/leaving a certain technology/unit. These can be energy-related commodities (e.g., electricity, natural gas, etc.), emissions, or other commodities (e.g., water, steel). The capacity of the unit must be unambiguously defined based on certain commodity flows (e.g., the capacity of a CHP could be based on the output electricity, the output heat, the sum of both or the input natural gas). Therefore, a group of commodities need to be defined which define the capacity of the unit/technology. This is the so-called 'Capacity defining commodity group' (cdcg)\footnote{In TIMES, this is called the 'Primary commodity group'}, and should be defined by the users (defaults can apply). This capacity thus restricts the flows of the commodities in the Cdcg (similar to TIMES EQ CAPACT).

% (TIMES EQ ACTFLO).
% \begin{equation}
% \act = \sum_{\commodity : \commodity \in Pcg_{\unit}} \flow \UNITCONVFLOWTOACT \quad \forall \quad \units, \timesteps
% \end{equation}

% \subsubsection{Restrict activity to the available capacity}
\begin{equation} \label{eq:max_capacity}
\sum_{\commodity : \commodity \in Cdcg_{\unit}} \vFlow \le \pAF \pUnitConvCapToFlow \vCapacity \quad \forall \quad \units, \timesteps
\end{equation}



\subsubsection{Static relationships between input and output commodity flows}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
Between the different flows, relationships can be imposed. The most simple relationship is a linear relationship between input and output commodities/commodity groups (TIMES EQ PTRANS). Whenever there is only a single input commodity and a single output commodity, this relationship relates to the notion of an efficiency. This equation can however also be used for instance to relate emissions to input primary fuel flows. In the most general form of the equation, two commodity groups are defined (an input commodity group cg1 and an output commodity group cg2), and an equality relationship is expressed between both commodity groups. Note that whenever the relationship is specfied between groups of multiple commodities, there remains a degree of freedom regarding the composition of the input commodity flows within group cg1 and the output commodity flows within group cg2. Note further that the sign ($\le;=;\ge$) of the constraint should be selected by the user (attribute of the parameter instance)- TIMES EQ PTRANS. 

\paragraph{Relationship between output and input flows}
\begin{align} \label{eq:ratiooutputinputflow}
&\sum_{\commodity \in cg2} \vFlow[\commodity,\unit,out,\timestep] \{\le;=;\ge\} \nonumber \\
&\pRatioOutputInputFlow \sum_{\commodity \in cg1} \vFlow[\commodity,\unit,in,\timestep] \quad \forall \units, \timesteps
\end{align}

Additional relationships can further be imposed. Two basic constraints impose a linear relationship between multiple input commodities/commodity groups (Eq.~\eqref{eq:ratioinputinputflow} - similar to (TIMES EQ INSHR)), and a linear relationship between multiple output commodities/commodity groups (Eq.~\eqref{eq:ratiooutputoutputflow} - similar to TIMES EQ OUTSHR). These relationships reduce the degrees of freedom. The relationship between different input flows can for instance be used to define a fixed or maximal share of bio-mass in a coal-fired power plant. The relationship between different output flows can for instance be used to define a relationship between the heat and electrical power outputs of a CHP plant, or to establish relationships between different outputs in an distillery. 

\paragraph{Relationship between multiple input flows}
\begin{align} \label{eq:ratioinputinputflow}
&\sum_{\commodity \in cg2} \vFlow[\commodity,\unit,in,\timestep] \{\le;=;\ge\} \nonumber \\
&\pRatioInputInputFlow \sum_{\commodity \in cg1} \vFlow[\commodity,\unit,in,\timestep] \quad \forall \units, \timesteps
\end{align}

\paragraph{Relationship between multiple output flows}
\begin{align} \label{eq:ratiooutputoutputflow}
&\sum_{\commodity \in cg2} \vFlow[\commodity,\unit,outn,\timestep] \{\le;=;\ge\} \nonumber \\
&\pRatioOutputOutputFlow \sum_{\commodity \in cg1} \vFlow[\commodity,\unit,out,\timestep] \quad \forall \units, \timesteps
\end{align}

{\color{red}
The above equations indicate that it might not be so simple as simply defining the value of a number of parameters which either belong to a unit or commodity. The user might also need to specify to which commodity groups different parameters relate and which bound is applied on the induced constraint (equality, lower bound, upper bound) - see e.g., parameter $\pRatioOutputInputFlow$. Also, this parameter can be defined multiple times for different input and output commodity groups. 
}

\subsubsection{Bounds on input and output commodity flows}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
{\color{red} TO ELABORATE}

The above static relationships represent constraints on the ratios between different commodity flows per unit. Additionally, bounds can be put on the instantaneous or total absolute flows generated by each unit, or even on the instantaneous or total flows from all units together (the latter are no longer technological constraints though).

Note that for the commodities correspondong to the units' capacity defining commodity group, a bound on the commodity flows is already generated (restricting flows to the installed capacity) - see Eq.~\eqref{eq:max_capacity} or Eq.~\eqref{eq:maximumoperatingpoint}.




\subsubsection{Dynamic constraints on input and output commodity flows}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\paragraph{Ramping constraints} These constraints induce a bound on the rate of change of a flow of certain commodities/commodity groups. The commodity group cg to which the ramping constraint applies needs to be specified.

There are many different possible formulations of ramping constraints. Hence, the equation is dependent on the archetype selected. Below is are two ramping equation versions represented: one for archetypes which do not have commitment variables, and one for archetypes which do have commitment variables

Without commitment variables ({\color{red} Should in principle be based on available rather than total capacity}):
\begin{align} \label{eq:updwardrampingconstraintwithoutcommitmentvariables}
&\sum_{\commodity \in cg} \Big( \vFlow[\commodity,\unit,in/out,\timestep+1] - \vFlow \Big) \le \pRampRateUp \vCapacity \pDeltaT \nonumber \\
&\forall \units, \timesteps
\end{align}

\begin{align} \label{eq:downdwardrampingconstraintwithoutcommitmentvariables}
&\sum_{\commodity \in cg} \Big( \vFlow[\commodity,\unit,in/out,\timestep+1] - \vFlow \Big) \le \pRampRateDown \vCapacity \pDeltaT\nonumber \\
& \forall \units, \timesteps
\end{align}



With commitment variables:
\begin{align} \label{eq:updwardrampingconstraintwithcommitmentvariables}
\sum_{\commodity \in cg} \Big( \vFlow[\commodity,\unit,in/out,\timestep+1] - \vFlow \Big) \le & (\vUnitsOnline-\vUnitsShuttingDown) \pRampRateUp \pUnitCapacity \pDeltaT \nonumber \\
& - \vUnitsShuttingDown \pMinimumOperatingPoint \nonumber \\
& +\vUnitsStartingUp \pMaxStartUpPower \nonumber \\
& \forall \units, \timesteps
\end{align}

\begin{align} \label{eq:downdwardrampingconstraintwithcommitmentvariables}
\sum_{\commodity \in cg} \Big( \vFlow - \vFlow[\commodity,\unit,in/out,\timestep+1] \Big) \le &(\vUnitsOnline-\vUnitsShuttingDown) \pRampRateDown \pUnitCapacity \pDeltaT \nonumber \\
& - \vUnitsStartingUp \pMinimumOperatingPoint \nonumber \\
& + \vUnitsShuttingDown \pMaxShutDownPower \nonumber \\
& \forall \units, \timesteps
\end{align}






\subsubsection{Commitment-related constraints}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
For modeling certain technologies/units, it is important to not only have flow variables of different commodities, but also model the on/off ("commitment") status of the unit/technology at every time step. Therefore, an additional variable $\vUnitsOnline$ is introduced. This variable represents the number of online units of that technology (for a normal unit commitment model, this variable might be a binary, for investment planning purposes, this might also be an integer or even a continuous variable - this will depend on the archetype of the unit.)

Commitment variables will be introduced by the following constraints (with corresponding parameters):
\begin{itemize}
	\item Minimum operating point ($\pMinimumOperatingPoint$)
	\item Minimum up time ($\pMinimumUpTime$)
	\item Minimum down time ($\pMinimumDownTime$)
	\item Certain ramp-rate formulations depending on the archetype ($\pRampRateUp$, $\pRampRateDown$)
\end{itemize}

Additionally, start-up and shut-down variables might need to be introduced for modeling start-up costs, minimum up time and minimum down-time constraints.

Whenever commitment variables are introduced, the capacity constraint (Eq.~\eqref{eq:max_capacity}) needs to be redefined:
\begin{equation} \label{eq:maximumoperatingpoint}
\sum_{\commodity : \commodity \in Cdcg_{\unit}} \vFlow \le \vUnitsOnline \pUnitCapacity \quad \forall \quad \units, \timesteps
\end{equation}

Additionally, the number of online units need to be restricted to the installed and available capacity:
\begin{equation} \label{eq:maximumonlineunits}
\vUnitsOnline \le \vUnitsAvailable \quad \forall \quad \units, \timesteps
\end{equation}
\begin{equation} \label{eq:availableunits}
\vUnitsAvailable \pUnitCapacity \le \pAF \vCapacity \quad \forall \quad \units, \timesteps
\end{equation}

\paragraph{Minimum operating point}
A first commitment-related constraint is the minimal operating point of an online unit. The minimum operating point can be based on the flows of input or output commodities/commodity groups cg ({\color{red}
Is this always for the capacity defining commodity group, or are there instances where a minimum operating point is defined for other commodities/commodity groups?} See example below, if reserve capacity and electrical power together form the Cdcg of a coal-fired power plant, than the Cdcg should not be used here):
\begin{align} \label{eq:minimumoperatingpoint}
&\sum_{\commodity \in cg} \vFlow \ge \pMinimumOperatingPoint \vUnitsOnline \pUnitCapacity \nonumber \\
& \forall \units, \timesteps
\end{align}

{\color{red} To check: how to approach the installed capacity - this can be a parameter or a variable (or both) dependending on the problem?}


\paragraph{Minimum up time}
\begin{align} \label{eq:minimumuptime}
&\vUnitsShuttingDown \le \vUnitsOnline - \sum_{\timestep'=1}^{\pMinimumUpTime - 1} \vUnitsStartingUp[\unit,\timestep-\timestep'] \nonumber \\
& \forall \units, \timesteps
\end{align}
{\color{red} This is the basic constraint. However, whenever non-spinning downward reserves are considered, an additional term which represents 'the units available to shut down in order to provide downward reserves' needs to be added to the left-hand side of the equation. How to deal with this in a generic way?}

\paragraph{Minimum down time}
\begin{align} \label{eq:minimumdowntime}
&\vUnitsStartingUp \le \vUnitsAvailable - \vUnitsOnline - \sum_{\timestep'=1}^{\pMinimumDownTime - 1} \vUnitsShuttingDown[\unit,\timestep-\timestep'] \nonumber \\
& \forall \units, \timesteps
\end{align}
{\color{red} This is the basic constraint. However, whenever non-spinning upward reserves are considered, an additional term which represents 'the units available to start up in order to provide upward reserves' needs to be added to the left-hand side of the equation. How to deal with this in a generic way?}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{System constraints}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

For each endogenous commodity, a commodity balance constraint is induced. The user is free to define whether an inequality or equality sign is used for the balance - TIMES EQ COMBAL
\begin{align} \label{eq:commodity_balance}
&\sum_{\unit : \commodity \in \OutputCommodities} \vFlow[\commodity,\unit,out,\timestep] \{\ge;=\} \nonumber \\ 
&\pDemand + \sum_{\unit: \commodity \in \InputCommodities} \vFlow[\commodity,\unit,in,\timestep] \nonumber \\ 
& \forall \EndogenousCommodities, \timesteps 
\end{align}


\subsubsection{On treatment of exogenous commodities}
Dealing with "Importing" of exogenous commodities (quotation marks because "importing" can truly mean the import from outside the modeled regions or it can also be the production of that commodity inside the modeled region by processes which are not explcitly modeled). Here, we assume that the costs related to importing a single unit can either be constant but can also vary with the total imported amount. For dealing with imports of these exogenous commodities, I see two options.
\paragraph{Option 1:}
Import variables ($\vImport$) are created (one variable per commodity, timestep on which the commodity is traced, and segment in the piecewise linear cost curve). An equation is added to ensure that the total import (sum of the different import segments) equals the net flow of that commodity. No balance constraint on the flow variables of this commodity should be induced (the constraint below replaces this). 
\begin{align}
&\sum_{\segment \in \ImportSegments} \vImport =  \sum_{\unit \in \InputCommodities} \vFlow[\commodity,\unit,in,\timestep]  - \sum_{\unit \in \OutputCommodities} \vFlow[\commodity,\unit,out,\timestep]  \nonumber \\
& \forall \commodities, \timesteps
\end{align}
\paragraph{Option 2:}
An 'import unit' is created which has no input commodities but has the specific commoditiy as an output commodity. A cost is attached to the 'generation' of the commodity. In this option, there must be a commodity balance (Eq.~\eqref{eq:commodity_balance}) equation to make sure that the output flows of the import unit are sufficient (and hence, the correct cost can be attached). In addition, when piecewise segments are being used (non-constant import costs), additional import variables ($\vImport$) need to be created and the sum of the different segments should be equated to the output flow of that process
\begin{align}
&\sum_{\segment \in \ImportSegments} \vImport =  \vFlow[\commodity,ImportUnit,out,\timestep] \nonumber \\
& \forall \commodities, \timesteps
\end{align}

Drawbacks of option 2:
\begin{itemize} 
	\item In comparison to option 1, there is one more constraint per commodity, and timestep on which the commodity is traced.
	\item In comparison to option 1, there is an additional variable per commodity and timestep ($\vFlow[\commodity,ImportUnit,out,\timestep]$)
\end{itemize}
Advantages of option 2:
\begin{itemize}
	\item There is a flow variable related to the import of that commodity -> one variable $\vFlow$ now describes all the flows (whereas if you want to say something about the 'import flows' in option 1, you would need to go look at the $\vImport$ variables). This can be easyer for post-processing.
	\item Using a unit for importing might provide more flexibility as all the generic unit parameters are available to model specific constraints related to the imports. For instance, a cost can be placed on the capacity for importing, etc. 
\end{itemize}

Note that all commodities defined in the data will be treated explicitly (so also the exogenous commodities). For example, in a UC model, there will be flow variables for, for instance, coal consumed by a coal-fired power plant. This might not be efficient for all cases. If the user wants to overcome this issue, the user is free to not define the coal commodity in the model but rather define a generation cost of the coal-fired power plant (parameter $\pConversionCost$).\footnote{I don't see any other option. Ofcourse, it should be possible to start from a datasource where fuel commodities are specified, then make a simple conversion tool to adapt the parameters of the plants involved based on this price, and subsequently run the Spine model.} 



{\color{red}
\begin{itemize}
\item It is likely not desirable to have a commodity balance and flow variables for each commodity. I guess it is only not needed to track flows and impose a balance constraint whenever certain commodities are unconstrained and the costs do not vary with the consumed/produced amounts. -> Have subsets of commodities for which these conditions do/do not hold?
\item More efficient to impose the commodity balance on different timescales for different commodities (e.g., coal, emissions sufficient to track annually, electricity at highest resolution - ofcourse up to the user to decide this). Implications for the model equations need to be further investigated. 
\end{itemize}
}
























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Examples}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Thermal power plant}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
As a first example, let's consider the DA scheduling of a simple dispatchable coal power plant. In this example, the power plant is assumed to have a single input commodity, namely coal, and three output commodities: electricity, upward spinning reserve capacity and greenhouse gas emissions. The operations of the power plant are assumed to be characterized by the following equations:
\begin{itemize}
\item maximum power + availability factor 
\item fuel consumption
\item greenhouse gas emissions
\item minimum operating point
\item minimum up time
\item minimum down time
\item ramp rate restrictions for energy provision
\item ramp rate restrictions for reserve capacity provision
\end{itemize}

The following sections elaborate on how each of these constraints is/can be implemented in the generic model formulation.

\subsubsection{Maximum power}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
The output of the coal-fired power plant (power and upward reserve capacity) is restricted by Eq.~\eqref{eq:max_capacity}. For this unit, the capacity defining commodity group (Cdcg) consists of the commodities electrical power and reserve capacity. Furthermore, both capacity and flow variables are in the same units ([MW]) and hence the parameter $\pUnitConvCapToFlow$ equals 1. The equations hence becomes:
\begin{align}
\vFlow[ElectricalPower,u,out,t] + \vFlow[UpwardReserves,u,out,t] \le \pAF \vCapacity \quad \forall \units, \timesteps \nonumber
\end{align}

\subsubsection{Fuel consumption}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
The fuel consumption can be defined by establishing a relationship between the flow variable for electrical power, and the flow variable for coal. Here, a linear relationship between these flows is assumed (corresponding to a constant efficiency). This relationship can be imposed by Eq.~\eqref{eq:ratiooutputinputflow}. Here, cg2 refers to the electrical power and cg1 refers to coal. The parameter $\pRatioOutputInputFlow[u,ElectricalPower,Coal]$ thus corresponds to the efficiency $\eta$ of the coal-fired power plant. The equation becomes
\begin{align}
\vFlow[ElectricalPower,u,out,t] = \eta \vFlow[Coal,u,in,t] \quad \forall \units, \timesteps
\end{align}

\subsubsection{GHG emissions}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
The emissions of greenhouse gases can be defined by establishing a relationship between the flow variable for greenhouse gas emissions, and the flow variable for coal\footnote{Note that an alternative option would be to establish a relationship between the flow variable of greenhouse gas emissions and the flow variable for electrical power (via Eq.~\eqref{eq:ratiooutputoutputflow}).}. This relationship can again be imposed by Eq.~\eqref{eq:ratiooutputinputflow}. Here, cg2 refers to the greenhouse gas emissions and cg1 refers to coal. The parameter $\pRatioOutputInputFlow[u,GreenhouseGas,Coal]$ thus corresponds to the emission factor/emission intensity $EF$ of the coal commodity. 
\begin{align}
\vFlow[GreenhouseGas,u,out,t] =  EF \vFlow[Coal,u,in,t] \quad \forall \units, \timesteps
\end{align}

{\color{red} An alternative option would be to link emissions directly to the commodity flows themselves. This would mean that the same equations are in the end generated, but that the parameter representing the emission factor would be indepdendent of the unit. THat is, there would be a parameter $p^{EmissionFactor}_{GreenhouseGas,Coal}$ representing the emission factor, which is independent of the unit. In that case, the units should only specify a capture rate parameter if needed for a specific type of emission (default 0\%).

The generic equation would then become:
\begin{align}
&\vFlow[\commodity,\unit,out,\timestep] = \sum_{InputCommodity \in InputCommodities} p^{EmissionFactor}_{\commodity,InputCommodity} p^{CaptureRate}_{\unit,\commodity} \vFlow[InputCommodity,\unit,in,\timestep] \nonumber \\
&  \forall \commodity \in EmissionCommodities, \units, \timesteps
\end{align}

The advantage is that the user does not need to define the relationship between an input commodity and an emission commodity for every unit and that EmissionFactor is more easy to interpret than RatioOutputInputFlow. Instead, the user only needs to specify an emission factor for each commodity. At this point, I don't think there are disadvantages to this approach?}


\subsubsection{Minimum operating point}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
Minimum operating point constraints can be introduced via the parameter $\pMinimumOperatingPoint$, which induces Eq.~\eqref{eq:minimumoperatingpoint}. This parameter needs to be specified for a specific commodity/commodity group. This specification is needed since it can be different than the capacity definining commodity group (Cdcg). For instance, for the coal-fired power plant considered here, the minimum operating point should be based on the ElectricalPower commodity and not on the sum of the ElectricalPower and the UpwardReserves commodity.


\subsubsection{Minimum up and down times}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
Minimum up and down time constraints are induced by specifying the corresponding parameters ($\pMinimumUpTime$ and $\pMinimumDownTime$).


\subsubsection{Ramping constraints}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
In this example, we assume a ramp rate which is constant for a given online unit, regardless of its current operating point. Depending on the stereotype, Eqs.~\eqref{eq:updwardrampingconstraintwithoutcommitmentvariables}-\eqref{eq:downdwardrampingconstraintwithoutcommitmentvariables} or Eqs.~\eqref{eq:updwardrampingconstraintwithcommitmentvariables}-\eqref{eq:downdwardrampingconstraintwithcommitmentvariables} will be generated.

Note that the ramping parameter again needs to be defined for a certain unit and commodity groups!




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Back-pressure CHP CCGT}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
TO DO



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Extraction-condensing CHP CCGT}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
TO DO




% \bibliographystyle{abbrv}
% \bibliography{mybibfile}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \bibliographystyle{abbrv}
% \bibliography{mybibfile}

\end{document}